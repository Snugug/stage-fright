function nodeMap(a,b){return Array.prototype.map.call(a,b)}function idleRun(a){if('requestIdleCallback'in window)window.requestIdleCallback(a);else{const b=Date.now();return setTimeout(()=>{a({didTimeout:!1,timeRemaining:()=>{return Math.max(0,50-(Date.now()-b))}})},1)}}function getActiveSlide(){const a=location.hash.split('/');return a.shift(),{section:parseInt(a[0]),slide:parseInt(a[1]),fragment:parseInt(a[2])}}var Matrix=class{constructor(){const a=document.currentScript.src.split('?'),b=a[0];let c={};1<a.length&&(c=buildOptions(a[1])),document.location.search&&(c=buildOptions(document.location.search.substr(1))),this._script=b,this._options=c,this._notes=!1,this._raw={stage:document.querySelector('._stage'),groups:document.querySelectorAll('._stage--group'),slides:document.querySelectorAll('._stage--slide')},this._slides=nodeMap(this._raw.groups,d=>{const g=d.querySelectorAll('._stage--slide');return nodeMap(g,h=>{const j=h.querySelectorAll('.fragment');return 0===j.length?h:[h].concat(nodeMap(j,k=>k))})})}get slides(){return this._slides}get stage(){return this._raw.stage}get script(){return this._script}get options(){return this._options}get notes(){return this._notes}set notes(a){return this._notes=a,a}};function buildOptions(a,b){let c=b||{};if(a){const d=`{"${decodeURI(a).replace(/&/g,'","').replace(/=/g,'":"')}"}`,g=JSON.parse(d,(h,j)=>{if(parseFloat(j).toString()===j)return parseFloat(j);try{return JSON.parse(j)}catch(k){return j}return j});c=Object.assign(g,c)}return c}var init=function(){const a=getActiveSlide();(isNaN(a.section)||isNaN(a.slide))&&history.pushState(null,null,`#/${0}/${0}`)},translate=function(a,b,c){const d=document.querySelector('._stage');let g=a,h=b;if(!(a&&b)&&0!==a&&0!==b){const l=getActiveSlide();a||(g=l.section),b||(h=l.slide)}const k=document.querySelector(`[data-slide="${h}"][data-section="${g}"]`).querySelectorAll('.fragment');for(let l=0;l<c;l++)k[l].setAttribute('data-active',!0);d.style.transform=`translateX(${-100*g}vw) translateY(${-100*h}vh)`},nav=class{static next(a){const c=getActiveSlide();let d=c.section,g=c.slide,h=c.fragment;return next(d,g,h,a)}static previous(a){const c=getActiveSlide();let d=c.section,g=c.slide,h=c.fragment;return previous(d,g,h,a)}static left(a){const c=getActiveSlide();let d=c.section,g=c.slide,h=c.fragment;return left(d,g,h,a)}static right(a){const c=getActiveSlide();let d=c.section,g=c.slide,h=c.fragment;return right(d,g,h,a)}static move(a,b,c){return translate(a,b,c)}};function move(a){let b=`#/${a.section}/${a.slide}`;const c=document.querySelector(`[data-slide="${a.slide}"][data-section="${a.section}"]`).querySelectorAll('.fragment[data-active]').length;isNaN(a.fragment)?(updateProgress(a.section,a.slide),translate(a.section,a.slide),0!==c&&(updateProgress(a.section,a.slide,c),a.fragment=c,b+=`/${c}`)):(updateProgress(a.section,a.slide,a.fragment),0!==a.fragment&&(b+=`/${a.fragment}`));const d=a.matrix.slides[a.section][a.slide].length-1;return Number.isInteger(d)&&isNaN(a.fragment)&&(a.fragment=0),history.pushState(null,null,b),sendMessage(a.matrix.notes,{position:{section:a.section+1,slide:a.slide+1,fragment:a.fragment,fragmentTotal:d,sectionTotal:a.matrix.slides.length,slideTotal:a.matrix.slides[a.section].length}}),sendNotes(a.section,a.slide,a.matrix),{section:a.section,slide:a.slide,fragment:a.fragment}}function right(a,b,c,d){let g=a,h=b;return sendMessage(d.notes,{move:'right'}),g=nextSection(g,d),h>lastSlide(g,d)&&(h=0),move({section:g,slide:h,matrix:d})}function left(a,b,c,d){let g=a,h=b;return sendMessage(d.notes,{move:'left'}),g=previousSection(g),h>lastSlide(g,d)&&(h=0),move({section:g,slide:h,matrix:d})}function previous(a,b,c,d){let g=a,h=b;if(sendMessage(d.notes,{move:'previous'}),Array.isArray(d.slides[g][h])){let k=d.slides[g][h][0].querySelectorAll('.fragment[data-active]');if(k){const l=k.length-1;if(0<=l)return k[l].removeAttribute('data-active'),move({section:g,slide:h,fragment:l,matrix:d})}}return h-=1,0>h&&(g=previousSection(g),h=0===g?0:lastSlide(g,d)),move({section:g,slide:h,matrix:d})}function next(a,b,c,d){let g=a,h=b,j=c;const k=d.slides.length;if(sendMessage(d.notes,{move:'next'}),Array.isArray(d.slides[g][h])){let l=d.slides[g][h][0].querySelector('.fragment:not([data-active])');if(l){const m=d.slides[g][h][0].querySelectorAll('.fragment[data-active]').length+1;return l.setAttribute('data-active',!0),move({section:g,slide:h,fragment:m,matrix:d})}}if(h+=1,j=void 0,h>lastSlide(g,d)){g=nextSection(g,d);let l=lastSlide(g,d);g===k-1&&h>l?h=l:g<=k-1&&(h=0)}return move({section:g,slide:h,fragment:j,matrix:d})}function previousSection(a){let b=a;return b-=1,0>b&&(b=0),b}function nextSection(a,b){let c=a;const d=b.slides.length;return c+=1,c>=d&&(c=d-1),c}function lastSlide(a,b){const d=b.slides[a].length;return d-1}function openNotes(a){const b={go:getActiveSlide()},c=a.slides[b.go.section][b.go.slide].length-1;let d=b.go.fragment;Number.isInteger(c)&&isNaN(b.go.fragment)&&(d=0);const g={position:{section:b.go.section+1,slide:b.go.slide+1,fragment:d,fragmentTotal:c,sectionTotal:a.slides.length,slideTotal:a.slides[b.go.section].length}},h=window.location,j=window.open(`${h.origin}${h.pathname}?notes=true`,'Stage Fright - Notes','width=1100,height=700');return console.log(g),setTimeout(()=>{sendMessage(j,b),sendMessage(j,g),sendNotes(b.go.section,b.go.slide,a)},1e3),j}function body(){const a=window.location,b=`
<style>
  body {
    margin: 0;
    padding: 0;
  }
</style>
<div class="_speaker-notes">
  <!-- Slide Preview -->
  <!-- Current Slide -->
  <div class="_speaker-notes--current">
    <div class="_speaker-notes--slide">
      <div class="_speaker-notes--holder">
        <iframe src="${a.origin}${a.pathname}?progress=false&responsive=true&listen=true${a.hash}" frameborder="0" class="slide--current" height="1024" width="1280"></iframe>
      </div>
    </div>
  </div>

  <!-- Upcoming Slide Slide -->
  <div class="_speaker-notes--upcoming">
    <div class="_speaker-notes--slide">
      <span class="_speaker-notes--label">Upcoming:</span>
      <div class="_speaker-notes--holder">
        <iframe src="${a.origin}${a.pathname}?progress=false&responsive=true&listen=true${a.hash}" frameborder="0" class="slide--upcoming" height="1024" width="1280"></iframe>
      </div>
    </div>
  </div>

  <!-- Controls -->
  <div class="_speaker-notes--controls">
    <div class="controls">
      <div class="controls--time">
        <h4 class="controls--label">Time <span class="controls--reset">Click to Reset</span></h4>
        <div class="timer">
          <span class="timer--hours">00</span><span class="timer--minutes">:00</span><span class="timer--seconds">:00</span>
        </div>
        <div class="clock">
          <span class="clock--value">0:00 AM</span>
        </div>
        <div class="controls--clear"></div>
      </div>
      <div class="controls--position">
        <p class="controls--fragment">Fragment <span class="controls--fragment-current"></span>/<span class="controls--fragment-total"></span></p>

        <p class="controls--slide">Slide <span class="controls--slide-current"></span>/<span class="controls--slide-total"></span></p>

        <p class="controls--section">Section <span class="controls--section-current"></span>/<span class="controls--section-total"></span></p>

      </div>
    </div>
  </div>

  <article class="_speaker-notes--notes">
    <div class="slide-notes">
      <h4 class="slide-notes--label">Notes</h4>
      <div class="slide-notes--content"></div>
    </div>
  </article>

</div>
`;return document.body.innerHTML=b,b}function sendNotes(a,b,c){let d=document.querySelector(`[data-slide="${b}"][data-section="${a}"] ._stage--notes`);return d=d?d.innerHTML:'<p></p>',sendMessage(c.notes,{notes:d}),d}function timing(){function a(){const m=new Date,n=m.getTime()-k.getTime(),o=Math.floor(n/3600000),q=Math.floor(n/60000%60),r=Math.floor(n/1e3%60);c.textContent=m.toLocaleTimeString('en-US',{hour12:!1,hour:'2-digit',minute:'2-digit'}),d.textContent=b(o),g.textContent=`:${b(q)}`,h.textContent=`:${b(r)}`,0>=o?d.setAttribute('data-mute',!0):d.removeAttribute('data-mute'),0>=q?g.setAttribute('data-mute',!0):g.removeAttribute('data-mute')}function b(m){const n=`00${parseInt(m)}`;return n.substring(n.length-2)}const c=document.querySelector('.clock--value'),d=document.querySelector('.timer--hours'),g=document.querySelector('.timer--minutes'),h=document.querySelector('.timer--seconds'),j=document.querySelector('.controls--time');let k=new Date;a();let l=setInterval(a,1e3);j.addEventListener('click',()=>{k=new Date,clearInterval(l),d.textContent=b(0),g.textContent=`:${b(0)}`,h.textContent=`:${b(0)}`,l=setInterval(a,1e3)})}function sendMessage(a,b){const c=window.location;a&&a.postMessage(b,c.origin)}function slideMessage(a){window.addEventListener('message',b=>{const c=b.origin||event.originalEvent.origin;return c===window.location.origin?b.data.move?nav[b.data.move](a):void 0:void 0},!1)}function notesMessage(){const a=document.querySelector('.slide--current'),b=document.querySelector('.slide--upcoming'),c=document.querySelector('.controls--fragment'),d=document.querySelector('.controls--fragment-current'),g=document.querySelector('.controls--fragment-total'),h=document.querySelector('.controls--slide-current'),j=document.querySelector('.controls--slide-total'),k=document.querySelector('.controls--section-current'),l=document.querySelector('.controls--section-total'),m=document.querySelector('.slide-notes--content');window.addEventListener('message',n=>{const o=n.origin||event.originalEvent.origin;if(o===window.location.origin){if(n.data.position)if(h.textContent=n.data.position.slide,j.textContent=n.data.position.slideTotal,k.textContent=n.data.position.section,l.textContent=n.data.position.sectionTotal,Number.isInteger(n.data.position.fragmentTotal)){c.setAttribute('data-active',!0);n.data.position.fragment;d.textContent=n.data.position.fragment,g.textContent=n.data.position.fragmentTotal}else c.removeAttribute('data-active'),d.textContent=1,g.textContent=1;if(n.data.move&&(sendMessage(a.contentWindow,{move:n.data.move}),sendMessage(b.contentWindow,{move:n.data.move})),n.data.go){let q=`#/${n.data.go.section}/${n.data.go.slide}`;n.data.go.fragment&&(q+=`/${n.data.go.fragment}`),a.src+=q,b.src+=q,sendMessage(b.contentWindow,{move:'next'})}n.data.notes&&(m.innerHTML=n.data.notes)}},!1)}var progress=function(a){idleRun(()=>{const b=document.createElement('nav');b.classList.add('progress');const c=getActiveSlide();let d=0;a.slides.forEach(g=>{const h=document.createElement('div');h.setAttribute('data-section',d),h.classList.add('progress--section');let j=0;g.forEach(k=>{const l=document.createElement('a');l.href=`#/${d}/${j}`,l.classList.add('progress--slide'),l.setAttribute('data-slide',j),l.setAttribute('data-section',d),l.setAttribute('tabindex','-1'),l.textContent=`Section ${d}, Slide ${j}`,Array.isArray(k)&&(l.style.opacity=.5,l.setAttribute('data-fragments',k.length-1)),c.section===d&&c.slide===j&&l.setAttribute('data-active','true'),h.appendChild(l),Array.isArray(k)?(k[0].setAttribute('data-slide',j),k[0].setAttribute('data-section',d),c.section===d&&c.slide===j&&k[0].setAttribute('data-active',!0)):(k.setAttribute('data-slide',j),k.setAttribute('data-section',d),c.section===d&&c.slide===j&&k.setAttribute('data-active',!0)),j++}),b.appendChild(h),d++}),!1!==a.options.progress&&document.body.appendChild(b),translate(c.section,c.slide,c.fragment),updateProgress(c.section,c.slide,c.fragment)}),window.addEventListener('hashchange',()=>{const c=getActiveSlide();updateProgress(c.section,c.slide,c.fragment),translate(c.section,c.slide,c.fragment),sendMessage(a.notes,{go:c})})};function updateProgress(a,b,c){const d=document.querySelectorAll('[data-active]:not(.fragment)'),g=document.querySelectorAll(`[data-section="${a}"][data-slide="${b}"`),h=document.querySelector('.progress--slide[data-active]');if(h)if(c){const j=parseInt(h.getAttribute('data-fragments'));c===j?(h.style.transitionProperty='none',h.style.opacity=1):(h.style.transitionProperty='none',h.style.opacity=.5)}else h.style.transitionProperty='all',nodeMap(d,j=>{j.removeAttribute('data-active')}),nodeMap(g,j=>{j.setAttribute('data-active','true')})}var keys=function(a){document.addEventListener('keydown',b=>{return a.stage.hasAttribute('data-overlay')?void 0:37===b.keyCode?nav.left(a):39===b.keyCode?nav.right(a):38===b.keyCode||33===b.keyCode?nav.previous(a):40===b.keyCode||34===b.keyCode||32===b.keyCode?nav.next(a):83===b.keyCode?(a.notes=openNotes(a),a):void 0})},overview=function(a){let b=!1;const c=a._raw.slides;document.addEventListener('keydown',d=>{if(27===d.keyCode){function g(q){const r=q.target.closest('[data-section][data-slide]');let t=r.getAttribute('data-section'),u=r.getAttribute('data-slide');h(c),a.stage.removeAttribute('data-overlay'),history.pushState(null,null,`#/${t}/${u}`),updateProgress(t,u),translate(t,u),b=!1}function h(q){nodeMap(q,r=>{r.removeEventListener('click',g)})}if(b=!b,!1==b)return a.stage.removeAttribute('data-overlay'),h(c),void translate();const j=window.innerWidth,k=window.innerHeight,l=a.stage.scrollWidth,m=a.stage.scrollHeight,n=j/l,o=k/m;if(n<=o){a.stage.style.transform=`scale(${j/(l+64/n)})`,a.stage.style.transformOrigin=`32px ${m*n/2-32}px`}else{let r=hwidth/(l+64/o);a.stage.style.transform=`scale(${r})`,a.stage.style.transformOrigin=`${l*o/2-32}px 32px`}a.stage.setAttribute('data-overlay','true'),nodeMap(c,q=>{q.addEventListener('click',g)})}})},stageFright=function(){const a=new Matrix;console.log(a),a.options.notes?(body(),timing(),notesMessage()):(init(),progress(a),keys(a),overview(a)),a.options.listen&&slideMessage(a),document.body.classList.add('stage-fright'),a.options.responsive&&(document.body.style.fontSize='1.5vw')};stageFright();
//# sourceMappingURL=stage-fright.js.map
