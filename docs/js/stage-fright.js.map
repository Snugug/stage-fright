{"version":3,"file":"stage-fright.js","sources":["../../src/js/lib/structure.js","../../src/js/lib/state/pubsub.js","../../src/js/lib/state/store.js","../../src/js/lib/state/mutations.js","../../src/js/lib/state/actions.js","../../src/js/lib/display/translate.js","../../src/js/lib/display/fragments.js","../../src/js/lib/navigation/hash.js","../../src/js/lib/navigation/history.js","../../src/js/lib/init.js","../../src/js/stage-fright.js"],"sourcesContent":["class StageFrightNode {\n  constructor(item) {\n    this.elem = item;\n    this.previous = null;\n    this.next = null;\n    this.first = false;\n    this.notes = null;\n\n    if (item.classList.contains('_stage--slide')) {\n      this.type = 'slide';\n\n      if (item.parentNode.firstElementChild === item) {\n        this.first = true;\n      }\n    } else if (item.classList.contains('fragment')) {\n      this.type = 'fragment';\n    }\n\n    const notes = item.querySelector('._stage--notes');\n    if (notes) {\n      this.notes = notes.innerHTML;\n    }\n  }\n}\n\nexport class StageFrightList {\n  constructor() {\n    this._head = null;\n    this._tail = null;\n    this._length = 0;\n\n    this._sectionHolder = -1;\n    this._depthHolder = 0;\n    this._fragmentHolder = 0;\n    this._fragmentDepth = [];\n  }\n\n  add(item) {\n    const node = new StageFrightNode(item);\n    let current = this._head;\n\n    if (node.first) {\n      this._sectionHolder++;\n      this._depthHolder = 0;\n    } else if (node.type !== 'fragment') {\n      this._depthHolder++;\n    }\n\n    if (node.type !== 'fragment') {\n      if (this._fragmentHolder !== 0) {\n        this._fragmentDepth.push(this._fragmentHolder);\n        this._fragmentHolder = 0;  \n      }\n    } else {\n      this._fragmentHolder++;\n      node.fragment = this._fragmentHolder;\n    }\n\n    node.section = this._sectionHolder;\n    node.depth = this._depthHolder;\n    node.previous = this._tail;\n    this._length++;\n\n    // If there isn't a head, make head, tail, and current our node! then increase the length;\n    if (!current) {\n      this._head = node;\n      this._tail = node;\n\n      return node;\n    }\n\n    // If there is a current, update the tail\n    this._tail.next = node;\n    this._tail = node;\n\n    if (node.type === 'fragment' && node.previous.type !== 'fragment') {\n      node.previous.fragment = 0;\n    }\n\n    if (node.type === 'fragment' && node.previous.notes) {\n      node.notes = node.previous.notes;\n    }\n\n    return node;\n  }\n\n  find(index) {\n    index = parseInt(index);\n\n    if (index > this._length - 1 || index < 0) {\n      return false;\n    }\n\n    // First\n    if (index === 0) {\n      return this._head;\n    }\n\n    // Last\n    if (index === this._length - 1) {\n      return this._tail;\n    }\n\n    // Start from the end or the beginning?\n    const headToTail = index <= Math.floor(this._length / 2);\n    let current = this._head;\n    let i = 1;\n\n    if (headToTail) {      \n      do {\n        current = current.next;\n        i++;\n      } while (i <= index);\n    }\n    else {\n      current = this._tail;\n      i = this._length - 2;\n\n      do {\n        current = current.previous;\n        i--;\n      } while (i >= index);\n    }\n\n    return current;\n  }\n\n  forEach(cb) {\n    let current = this._head;\n    let i = 0;\n    while (current.next) {\n      cb(current, i);\n      current = current.next;\n      i++;\n    }\n\n    cb(current);\n  }\n\n  updateFragments() {\n    const fragTotals = this._fragmentDepth.reverse();\n    let currentFrag = fragTotals.pop();\n    this.forEach(item => {\n      if (item.hasOwnProperty('fragment')) {\n        item.totalFragments = currentFrag;\n\n        if (item.next.type !== 'fragment') {\n          currentFrag = fragTotals.pop();\n        }\n      }\n    });\n  }\n\n  buildProgress(store, createMinimapLink) {\n    this.forEach((item, i) => {\n      if (item.type === 'slide') {\n        if (typeof i === 'undefined') {\n          i = this._length - 1;\n        }\n\n        item.progress = createMinimapLink(i, item.section, item.depth, item.hasOwnProperty('fragment'));\n      } else {\n        item.progress = item.previous.progress;\n      }\n    });\n  }\n}\n","export default class PubSub {\n  constructor() {\n    this.events = {};\n  }\n\n  subscribe(event, cb) {\n    if (!this.events[event]) {\n      this.events[event] = [];\n    }\n\n    return this.events[event].push(cb);\n  }\n\n  publish(event, data = {}) {\n    if (!this.events[event]) {\n      return [];\n    }\n\n    return this.events[event].map(cb => cb(data));\n  }\n}\n","import PubSub from './pubsub.js';\n\nexport default class Store {\n  constructor(params = {}) {\n    const self = this;\n\n    this.actions = params.actions || {};\n    this.mutations = params.mutations || {};\n    this.status = 'resting';\n    this.changes = new PubSub();\n    this.stage = params.stage || {};\n    this.progress = params.progress || [];\n    this.root = params.root || document.body;\n    this.help = params.help || false;\n\n    this.state = new Proxy(params.state || {}, {\n      set: function(state, key, value) {\n        state[key] = value;\n\n        if (self.status !== 'mutation') {\n          console.warn(`You should use a mutation to set ${key}`);\n        }\n\n        self.changes.publish(`${key}`, self.state);\n        self.changes.publish('stateChange', self.state);\n\n        return true;\n      },\n    });\n  }\n\n  dispatch(action, payload) {\n    if (typeof this.actions[action] !== 'function') {\n      console.error(`Action \"${action}\" doesn't exist`);\n      return false;\n    }\n\n    this.status = 'action';\n\n    this.actions[action](this, payload);\n\n    return true;\n  }\n\n  async commit(mutation, payload) {\n    if (typeof this.mutations[mutation] !== 'function') {\n      console.error(`Mutation \"${mutation}\" doesn't exist`);\n      return false;\n    }\n\n    this.status = 'mutation';\n\n    let newState = this.mutations[mutation](Object.assign({}, this.state), payload);\n\n    if ('then' in newState) {\n      newState = await newState;\n      this.state = Object.assign(this.state, newState);\n    } else {\n      this.state = Object.assign(this.state, newState);\n    }\n\n    return true;\n  }\n}\n","export default {\n  navigate(state, payload) {\n    if (payload === 'next' && state.current.next) {\n      state.current = state.current.next;\n      state.index = state.index + 1;\n    } else if (payload === 'previous' && state.current.previous) {\n      state.current = state.current.previous;\n      state.index = state.index - 1;\n    } else if (payload !== 'next' && payload !== 'previous') {\n      state.current = payload;\n    }\n\n    return state;\n  },\n  index(state, payload) {\n    state.index = payload;\n\n    return state;\n  },\n  progress(state, payload) {\n    const previous = state.progress;\n    state.progress = state.current.progress;\n\n    if (state.progress) {\n      if (previous && previous !== state.progress && previous.dataset.hasOwnProperty('active')) {\n        delete previous.dataset.active;\n      }\n\n      state.progress.dataset.active = true;\n\n      if (state.current.hasOwnProperty('fragment')) {\n        if (state.current.fragment === state.current.totalFragments) {\n          state.progress.dataset.fragments = false;\n        } else {\n          state.progress.dataset.fragments = true;\n        }\n      }\n    }\n\n    return state;\n  },\n  async notes(state, { root, length }) {\n    if (state.presentation.request) {\n      if (!state.presentation.connection) {\n        try {\n          const connection = await state.presentation.request.start();\n          state.presentation.connection = connection;\n\n          // Need a way to reverse this\n          const { notesBody, updateNotes, advancePresentation } = await import('../presentation');\n          const builtNotes = notesBody();\n          root.parentNode.insertBefore(builtNotes._notes, root);\n          root.dataset.hidden = true;\n          root.parentNode.dataset.notes = true;\n\n          updateNotes(builtNotes, state.index, state.current);\n          builtNotes.total.textContent = length - 1;\n          state.presentation.notes = builtNotes;\n        } catch (e) {\n          console.log(e);\n          console.error('There was an error establishing a connection');\n        }\n      } else {\n        root.parentNode.removeChild(state.presentation.notes._notes);\n        delete root.dataset.hidden;\n        delete root.parentNode.dataset.notes;\n        state.presentation.connection.terminate();\n        state.presentation.connection = null;\n        state.presentation.notes = null;\n      }\n    }\n\n    return state;\n  },\n  display(state, payload) {\n    if (state.display === 'presentation') {\n      state.display = 'article';\n    } else {\n      state.display = 'presentation';\n    }\n\n    return state;\n  },\n  toggle(state, payload) {\n    state[payload] = !state[payload];\n\n    return state;\n  },\n};\n","export default {\n  navigate(context, payload) {\n    if (payload === 'next' || payload === 'previous') {\n      context.commit('navigate', payload);\n    } else {\n      const found = context.stage.find(payload);\n      context.commit('navigate', found);\n      context.commit('index', payload);\n    }\n\n    if (!context.embedded) {\n      context.commit('progress', 'toggle');\n    }\n  },\n  notes(context, payload) {\n    context.commit('notes', { root: context.root, length: context.stage._length });\n  },\n  display(context, payload) {\n    context.commit('display', payload);\n  },\n  toggle(context, payload) {\n    context.commit('toggle', payload);\n  },\n};\n","export default function(root, current) {\n  const transform = `translate(${-100 * current.section}vw) translateY(${-100 * current.depth}vh)`;\n  root.style.transform = transform;\n}\n","export default function(current) {\n  let active = false;\n\n  // Make the current fragment active (only will happen on _next_)\n  if (current.type === 'fragment') {\n    const dataset = current.elem.dataset;\n    if (!dataset.hasOwnProperty('active') || dataset.active === 'false') {\n      dataset.active = true;\n\n      let previous = current.previous;\n\n      while (previous && previous.type === 'fragment') {\n        previous.elem.dataset.active = true;\n        previous = previous.previous;\n      }\n      \n      active = true;\n    }  \n  }\n\n  // Make the next fragment inactive if we didn't make the current one active\n  if (active === false && current.next && current.next.type === 'fragment') {\n    delete current.next.elem.dataset.active;\n  }\n}\n","export default function(max) {\n  const starter = new URL(window.location);\n  let pos = 0;\n\n  if (starter.hash) {\n    pos = parseInt(starter.hash.split('/')[1]);\n  }\n\n  if (pos < 0) {\n    pos = 0;\n  } else if (pos > max) {\n    pos = max;\n  }\n\n  return pos;\n}\n","export default function updateHistory(index) {\n  history.pushState(null, null, `#/${index}`);\n}\n","import { StageFrightList } from './structure';\n\nimport Store from './state/store';\nimport mutations from './state/mutations';\nimport actions from './state/actions';\n\nimport translate from './display/translate';\nimport fragments from './display/fragments';\n\nimport navHash from './navigation/hash';\nimport updateHistory from './navigation/history';\n\nimport { createPresentation } from './presentation';\n\nexport default class StageFright {\n  constructor(root, options = { spacebar: true, remote: true }) {\n    const rootNode = document.querySelector(root);\n    // Make the Stage Fright Stage\n    rootNode.parentNode.classList.add('stage-fright');\n\n    const items = Array.from(rootNode.querySelectorAll('._stage--slide, .fragment'));\n\n    // Stage\n    const stage = new StageFrightList();\n    items.forEach(item => {\n      stage.add(item);\n    });\n    stage.updateFragments();\n\n    const embedded = new URLSearchParams(window.location.search).get('embedded') === 'true';\n\n    if (embedded) {\n      rootNode.parentNode.classList.add('embedded');\n    }\n\n    // Presentation Awesomeness\n    let presentation = false;\n\n    // Starting Index\n    const start = navHash(stage.length - 1);\n\n    // Set up state and store\n    this.store = new Store({\n      actions,\n      mutations,\n      progress: 'foo',\n      state: {\n        current: stage._head,\n        progress: null,\n        index: start,\n        notes: false,\n        presentation: createPresentation(),\n        display: 'presentation',\n        help: false,\n      },\n      stage,\n      embedded,\n      root: rootNode,\n    });\n\n    this.store.changes.subscribe('current', async state => {\n      translate(rootNode, state.current);\n      fragments(state.current);\n      if (state.presentation.notes) {\n        const { updateNotes } = await import('./presentation');\n        updateNotes(state.presentation.notes, state.index, state.current);\n      }\n    });\n\n    this.store.changes.subscribe('index', async state => {\n      updateHistory(state.index);\n\n      if (!embedded) {\n        const { advancePresentation } = await import('./presentation');\n        advancePresentation(state.presentation.connection, state.index);\n      }\n\n      if (state.presentation.notes) {\n        const { updateNotes } = await import('./presentation');\n        updateNotes(state.presentation.notes, state.index, state.current);\n      }\n    });\n\n    this.store.changes.subscribe('display', state => {\n      if (state.display === 'presentation') {\n        rootNode.parentNode.classList.add('stage-fright');\n        document.body.scrollTop = document.documentElement.scrollTop = 0;\n      } else {\n        rootNode.parentNode.classList.remove('stage-fright');\n      }\n    });\n\n    this.store.changes.subscribe('presentation', async state => {\n      if (state.presentation.connection) {\n        const { advancePresentation } = await import('./presentation');\n\n        state.presentation.connection.addEventListener('message', e => {\n          const message = JSON.parse(e.data);\n\n          if (message.start) {\n            advancePresentation(state.presentation.connection, state.index);\n          }\n\n          if (message.goto !== state.index) {\n            this.goto(message.goto);\n          }\n        });\n      }\n    });\n\n    requestIdleCallback(\n      () => {\n        if (!embedded) {\n          import('./upgrade').then(({ upgrade }) => {\n            upgrade.bind(this)(stage, rootNode, start, options);\n          });\n        } else {\n          this.goto(start);\n        }\n      },\n      { timeout: 500 },\n    );\n\n    // Set up progress\n    window.addEventListener('hashchange', () => {\n      const pos = navHash(stage.length - 1);\n      this.goto(pos);\n    });\n\n    import('./lazyload').then(({ default: lazyload }) => lazyload());\n  }\n\n  next() {\n    this.store.dispatch('navigate', 'next');\n  }\n\n  previous() {\n    this.store.dispatch('navigate', 'previous');\n  }\n\n  goto(slide) {\n    this.store.dispatch('navigate', slide);\n  }\n}\n","import StageFright from './lib/init.js';\n\nwindow.addEventListener('DOMContentLoaded', () => {\n  const stage = new StageFright('._stage');\n  window.stage = stage;\n});\n"],"names":["StageFrightNode","constructor","item","elem","previous","next","first","notes","classList","contains","type","parentNode","firstElementChild","querySelector","innerHTML","StageFrightList","_head","_tail","_length","_sectionHolder","_depthHolder","_fragmentHolder","_fragmentDepth","add","node","current","push","fragment","section","depth","find","index","parseInt","headToTail","Math","floor","i","forEach","cb","updateFragments","fragTotals","reverse","currentFrag","pop","hasOwnProperty","totalFragments","buildProgress","store","createMinimapLink","progress","PubSub","events","subscribe","event","publish","data","map","Store","params","self","actions","mutations","status","changes","stage","root","document","body","help","state","Proxy","set","key","value","console","warn","dispatch","action","payload","error","commit","mutation","newState","Object","assign","navigate","dataset","active","fragments","length","presentation","request","connection","start","notesBody","updateNotes","advancePresentation","builtNotes","insertBefore","_notes","hidden","total","textContent","e","log","removeChild","terminate","display","toggle","context","found","embedded","transform","style","max","starter","URL","window","location","pos","hash","split","updateHistory","history","pushState","StageFright","options","spacebar","remote","rootNode","items","Array","from","querySelectorAll","URLSearchParams","search","get","navHash","createPresentation","translate","scrollTop","documentElement","remove","addEventListener","message","JSON","parse","goto","requestIdleCallback","then","upgrade","bind","timeout","default","lazyload","slide"],"mappings":"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"}