{"version":3,"file":"upgrade.js","sources":["../../src/js/lib/icons.js","../../src/js/lib/help.js","../../src/js/lib/buttons.js","../../src/js/lib/minimap.js","../../src/js/lib/navigation/keys.js","../../src/js/lib/autoplay.js","../../src/js/lib/upgrade.js"],"sourcesContent":["export default {\n  download:\n    '<svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 32 32\"><path d=\"M26 15l-1.41-1.41L17 21.17V2h-2v19.17l-7.59-7.58L6 15l10 10 10-10z\"/><path d=\"M26 24v4H6v-4H4v4a2 2 0 0 0 2 2h20a2 2 0 0 0 2-2v-4z\"/></svg>',\n  presentation:\n    '<svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 32 32\"><path d=\"M15 10h2v8h-2zm5 4h2v4h-2zm-10-2h2v6h-2z\"/><path d=\"M25 4h-8V2h-2v2H7a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h8v6h-4v2h10v-2h-4v-6h8a2 2 0 0 0 2-2V6a2 2 0 0 0-2-2zm0 16H7V6h18z\"/></svg>',\n  article:\n    '<svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 32 32\"><path d=\"M4 24h10v2H4zm0-6h10v2H4zm22-4H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h20a2 2 0 0 1 2 2v6a2 2 0 0 1-2 2zM6 6v6h20V6zm20 22h-6a2 2 0 0 1-2-2v-6a2 2 0 0 1 2-2h6a2 2 0 0 1 2 2v6a2 2 0 0 1-2 2zm-6-8v6h6v-6z\"/></svg>',\n  help:\n    '<svg role=\"presentation\" xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 32 32\"><path d=\"M16 2a14 14 0 1 0 14 14A14 14 0 0 0 16 2zm0 26a12 12 0 1 1 12-12 12 12 0 0 1-12 12z\"/><circle cx=\"16\" cy=\"23.5\" r=\"1.5\"/><path d=\"M17 8h-1.5a4.49 4.49 0 0 0-4.5 4.5v.5h2v-.5a2.5 2.5 0 0 1 2.5-2.5H17a2.5 2.5 0 0 1 0 5h-2v4.5h2V17a4.5 4.5 0 0 0 0-9z\"/></svg>',\n  speaker:\n    '<svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 32 32\" style=\"transform: rotate(180deg)\"><path d=\"M28 4H10a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h18a2 2 0 0 0 2-2V6a2 2 0 0 0-2-2zm0 16H10V6h18z\"/><path d=\"M16 26H4V16h2v-2H4a2 2 0 0 0-2 2v10a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2v-2h-2z\"/></svg>',\n};\n","import icons from './icons';\n\nexport default function help(store) {\n  let previousFocus = null;\n\n  const dialog = buildHelp(store);\n  const close = dialog.querySelector('.sf-dialog--close');\n  const overlay = document.createElement('div');\n  overlay.classList.add('sf-overlay');\n\n  // Make Overlay click close\n  overlay.addEventListener('click', e => {\n    store.dispatch('toggle', 'help');\n  });\n\n  store.changes.subscribe('help', state => {\n    if (state.help) {\n      dialog.style.display = 'block';\n      overlay.style.display = 'block';\n      previousFocus = document.activeElement;\n      close.focus();\n    } else {\n      dialog.style.display = 'none';\n      overlay.style.display = 'none';\n      if (previousFocus) {\n        previousFocus.focus();\n        previousFocus = null;\n      }\n    }\n  });\n\n  document.body.appendChild(dialog);\n  document.body.appendChild(overlay);\n}\n\nfunction buildHelp(store) {\n  const dialog = document.createElement('div');\n  dialog.classList.add('sf-dialog');\n  dialog.setAttribute('role', 'dialog');\n  dialog.setAttribute('aria-labelledby', 'sf-dialog--title');\n  dialog.setAttribute('aria-describedby', 'sf-dialog--description');\n  let innerHTML = `<h2 id=\"sf-dialog--title\">Using This Presentation</h2>\n  <p id=\"sf-dialog--description\" class=\"sf-dialog--sr-only\">Controls and actions you can take in this presentation</p><div class=\"sf-dialog--body\">`;\n\n  // Keyboard Shortcuts\n  const keyboard = [\n    {\n      desc: 'Navigate presentation forward',\n      opts: ['<kbd>space</kbd>', '<kbd>page up</kbd> (presenter remote forward)'],\n    },\n    {\n      desc: 'Navigate presentation backward',\n      opts: ['<kbd>shift</kbd>+<kbd>space</kbd>', '<kbd>page down</kbd> (presenter remote back)'],\n    },\n    {\n      desc: 'Presentation overview',\n      opts: ['<kbd>esc</kbd>'],\n    },\n  ];\n\n  if (store.state.presentation.request) {\n    keyboard.push({\n      desc: 'Toggle speaker notes/presentation view (requires external monitor)',\n      opts: ['<kbd>alt</kbd>+<kbd>shift</kbd>+<kbd>s</kbd>'],\n    });\n  }\n\n  innerHTML += `<div class=\"sf-dialog--keyboard\"><h3>Keyboard Navigation</h3><p>Keyboard shortcuts to use the presentation.</p><dl>${keyboard\n    .map(i => `<dt>${i.desc}</dt>${i.opts.map(opt => `<dd>${opt}</dd>`).join('')}`)\n    .join('')}</dl></div>`;\n\n  // Icons\n  const iconography = [\n    {\n      icon: icons.download,\n      desc: 'Download all images and videos that would otherwise be lazyloaded.',\n    },\n    {\n      icon: icons.article,\n      desc:\n        'Toggle from presentation view to article view. Article view includes visible speaker notes',\n    },\n    {\n      icon: icons.presentation,\n      desc: 'Toggle from article view to presentation view.',\n    },\n    {\n      icon: icons.help,\n      desc: 'Launch the help overlay.',\n    },\n  ];\n\n  if (store.state.presentation.request) {\n    iconography.push({\n      desc: 'Toggle speaker notes/presentation view (requires external monitor)',\n      icon: icons.speaker,\n    });\n  }\n\n  innerHTML += `<div class=\"sf-dialog--iconography\"><h3>Iconography</h3><p>Icons used throughout the presentation.</p><dl>${iconography\n    .map(i => `<dt>${i.icon}</dt><dd>${i.desc}</dd>`)\n    .join('')}</dl></div>`;\n\n  innerHTML += '</div>';\n  dialog.innerHTML = innerHTML;\n\n  const close = document.createElement('button');\n  close.classList.add('sf-dialog--close');\n  close.setAttribute('aria-label', 'Close Help');\n  close.innerText = 'x';\n\n  dialog.appendChild(close);\n\n  close.addEventListener('click', e => {\n    store.dispatch('toggle', 'help');\n  });\n\n  dialog.addEventListener('keydown', e => {\n    // No key presses allowed in here!\n    e.preventDefault();\n    e.stopPropagation();\n\n    // Escape key, Enter key, Space\n    if (e.keyCode === 27 || e.keyCode === 13 || e.keyCode === 32) {\n      store.dispatch('toggle', 'help');\n    }\n  });\n\n  return dialog;\n}\n","import { loadImage, loadMedia } from './lazyload';\nimport help from './help';\nimport icons from './icons';\n\nexport default function(store) {\n  const holder = document.createElement('div');\n  holder.classList.add('btns');\n\n  holder.appendChild(downloadImages());\n\n  if (store.state.presentation.channel) {\n    holder.appendChild(toggleSpeaker(store));\n  }\n  holder.appendChild(toggleDisplay(store));\n  holder.appendChild(getHelp(store));\n\n  holder.appendChild(hiddenPresButton());\n\n  help(store);\n\n  return holder;\n}\n\nfunction buildButton(title, image) {\n  const btn = document.createElement('button');\n  btn.classList.add(`btns--btn`);\n  btn.setAttribute('aria-label', title);\n  btn.innerHTML = image;\n  return btn;\n}\n\nfunction hiddenPresButton() {\n  const btn = document.createElement('button');\n  btn.classList.add('btns--hidden');\n  btn.setAttribute('aria-label', 'Presentation Navigation Keyboard Focus');\n  btn.innerHTML = '';\n  return btn;\n}\n\nfunction downloadImages() {\n  const icon = icons.download;\n  const btn = buildButton('Download All Assets', icon);\n\n  btn.addEventListener('click', () => {\n    // Swap in\n    const images = document.querySelectorAll('picture, img');\n    const media = document.querySelectorAll('video, audio');\n    images.forEach(image => loadImage(image));\n    media.forEach(item => loadMedia(item));\n    btn.parentNode.removeChild(btn);\n  });\n\n  return btn;\n}\n\nfunction toggleDisplay(store) {\n  const { presentation } = icons;\n  const { article } = icons;\n  const btn = buildButton('Toggle Article/Presentation Display', article);\n\n  btn.addEventListener('click', () => {\n    store.dispatch('display', 'toggle');\n  });\n\n  store.changes.subscribe('display', state => {\n    if (state.display === 'presentation') {\n      btn.innerHTML = article;\n    } else {\n      btn.innerHTML = presentation;\n    }\n  });\n\n  return btn;\n}\n\nfunction toggleSpeaker(store) {\n  const btn = buildButton('Toggle Speaker Note/Presentation Display', icons.speaker);\n\n  btn.addEventListener('click', () => {\n    store.dispatch('notes', 'toggle');\n  });\n\n  return btn;\n}\n\nfunction getHelp(store) {\n  const icon = icons.help;\n  const btn = buildButton('Help', icon);\n\n  btn.addEventListener('click', e => {\n    store.dispatch('toggle', 'help');\n  });\n\n  return btn;\n}\n","export function buildMinimap(stage) {\n  const minimap = document.createElement('nav');\n  minimap.classList.add('minimap');\n\n  stage.forEach(item => {\n    if (item.first) {\n      const section = document.createElement('div');\n      section.classList.add('minimap--section');\n      minimap.appendChild(section);\n    }\n\n    minimap.lastChild.appendChild(item.progress);\n  });\n\n  return minimap;\n}\n\nexport function createMinimapLink(to, section, depth, fragment = false) {\n  const link = document.createElement('a');\n  link.classList.add('minimap--slide');\n  link.href = `#/${to}`;\n  link.innerText = `Section ${section}, Slide ${depth}`;\n  link.dataset.fragments = fragment;\n\n  return link;\n}\n","export default function(store, opts = {}) {\n  document.addEventListener('keydown', e => {\n    if (store.state.display === 'presentation' && !e.target.classList.contains('btns--btn')) {\n      const whereto = spaceMove(e, opts);\n      if (whereto) {\n        if (whereto !== 'notes' && whereto !== 'esc') {\n          store.dispatch('navigate', whereto);\n        } else if (whereto === 'notes') {\n          store.dispatch('notes', 'toggle');\n        } else if (whereto === 'esc') {\n          store.dispatch('toggle', 'overview');\n        }\n      }\n    }\n  });\n}\n\nfunction spaceMove(e, opts) {\n  const modifiers = {\n    ctrl: e.ctrlKey === true, // ⌃\n    alt: e.altKey === true, // ⌥\n    meta: e.metaKey === true, // ⌘\n    shift: e.shiftKey === true, // ⇧\n  };\n\n  let previous = false;\n  let next = false;\n\n  // Set up Spacebar nav, with or without modifiers\n  if (opts.spacebar !== false) {\n    let spacebar = e.keyCode === 32;\n    let shiftSpacebar = spacebar && modifiers['shift'];\n\n    if (opts.spacebar !== true) {\n      spacebar = spacebar && modifiers[opts.spacebar];\n      shiftSpacebar = shiftSpacebar && modifiers[opts.spacebar];\n    }\n\n    previous = shiftSpacebar;\n    next = spacebar;\n  }\n\n  // Set up Remote nav, with or without modifiers\n  if (opts.remote !== false) {\n    let pageUp = e.keyCode === 33;\n    let pageDown = e.keyCode === 34;\n\n    if (opts.remote !== true) {\n      pageUp = pageUp && modifiers[opts.remote];\n      pageDown = pageDown && modifiers[opts.remote];\n    }\n\n    previous = previous || pageUp;\n    next = next || pageDown;\n  }\n\n  // Do previous or next navigation\n  if (previous) {\n    return 'previous';\n  }\n\n  if (next) {\n    return 'next';\n  }\n\n  // S + CMD + Shift key\n  if (e.keyCode === 83 && modifiers['alt'] && modifiers['shift']) {\n    return 'notes';\n  }\n\n  // Escape Key\n  if (e.keyCode === 27) {\n    return 'esc';\n  }\n\n  return false;\n}\n","import { loadMedia } from './lazyload';\n\nexport function playVideo(entry) {\n  const elem = entry.target;\n  elem.pause();\n  elem.currentTime = 0;\n\n  if (entry.isIntersecting) {\n    if (!elem.src) {\n      loadMedia(elem);\n    }\n    \n    window.setTimeout(() => {\n      elem.play();\n    }, 200);  \n  }\n}\n\nexport function playVideoObserver(entries) {\n  entries.forEach((entry) => {\n    playVideo(entry);\n  });\n}\n\nexport default function () {\n  const videos = document.querySelectorAll('video[data-autoplay]');\n\n  if ('IntersectionObserver' in window) {\n    const observer = new IntersectionObserver(playVideoObserver);\n    videos.forEach(video => observer.observe(video));\n  }\n}\n","import buttons from './buttons';\nimport { buildMinimap, createMinimapLink } from './minimap';\nimport keys from './navigation/keys';\nimport autoplay from './autoplay';\n\nexport function upgrade(stage, rootNode, start, options) {\n  // Add Buttons\n  // console.log(options._display);\n  if (!options._display) {\n    stage._head.elem.prepend(buttons(this.store));\n  }\n\n  stage.buildProgress(this.store, createMinimapLink);\n  rootNode.parentNode.appendChild(buildMinimap(stage));\n  this.goto(start);\n\n  // Set up keyboard navigation\n  keys(this.store, options);\n\n  // Set up Autoplay\n  autoplay();\n}\n"],"names":["download","presentation","article","help","speaker","store","previousFocus","dialog","buildHelp","close","querySelector","overlay","document","createElement","classList","add","addEventListener","e","dispatch","changes","subscribe","state","style","display","activeElement","focus","body","appendChild","setAttribute","innerHTML","keyboard","desc","opts","request","push","map","i","opt","join","iconography","icon","icons","innerText","preventDefault","stopPropagation","keyCode","holder","downloadImages","channel","toggleSpeaker","toggleDisplay","getHelp","hiddenPresButton","buildButton","title","image","btn","images","querySelectorAll","media","forEach","loadImage","item","loadMedia","parentNode","removeChild","buildMinimap","stage","minimap","first","section","lastChild","progress","createMinimapLink","to","depth","fragment","link","href","dataset","fragments","target","contains","whereto","spaceMove","modifiers","ctrl","ctrlKey","alt","altKey","meta","metaKey","shift","shiftKey","previous","next","spacebar","shiftSpacebar","remote","pageUp","pageDown","playVideo","entry","elem","pause","currentTime","isIntersecting","src","window","setTimeout","play","playVideoObserver","entries","videos","observer","IntersectionObserver","video","observe","upgrade","rootNode","start","options","_display","_head","prepend","buttons","buildProgress","goto","keys","autoplay"],"mappings":"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"}